<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.stylefeng.roses.kernel.system.modular.user.mapper.SysUserMapper">

    <!--获取用户分页列表-->
    <select id="findUserPage" resultType="cn.stylefeng.roses.kernel.system.pojo.user.SysUserResponse">
        select
        suser.user_id as userId,
        suser.account as account,
        suser.nick_name as nickName,
        suser.real_name as realName,
        suser.avatar as avatar,
        suser.birthday as birthday,
        suser.sex as sex,
        suser.email as email,
        suser.phone as phone,
        suser.tel as tel,
        suser.status_flag as statusFlag,
        suorg.org_id as orgId,
        suorg.position_id as positionId
        from sys_user suser
        left join sys_user_org suorg on suser.user_id = suorg.user_id
        <where>
            <if test="sysUserRequest.realName != null and sysUserRequest.realName != ''">
                and suser.real_name like concat('%',#{sysUserRequest.realName},'%')
            </if>
            <if test="sysUserRequest.account != null and sysUserRequest.account != ''">
                and suser.account like concat('%',#{sysUserRequest.account},'%')
            </if>
            <if test="sysUserRequest.statusFlag != null and sysUserRequest.statusFlag != ''">
                and suser.status_flag like concat('%',#{sysUserRequest.statusFlag},'%')
            </if>
            <if test="sysUserRequest.orgId != null and sysUserRequest.orgId != ''">
                and suorg.org_id in(select org_id from hr_organization where org_pids like CONCAT('%[',#{sysUserRequest.orgId},']%') or
                org_id=#{sysUserRequest.orgId})
            </if>
            and suser.del_flag = 'N'
            order by suser.create_time desc
        </where>

    </select>

    <!--获取用户列表-->
    <select id="findUserList" resultType="cn.stylefeng.roses.kernel.system.pojo.user.SysUserResponse">
        select
        suser.user_id as userId,
        suser.account as account,
        suser.nick_name as nickName,
        suser.real_name as realName,
        suser.avatar as avatar,
        suser.birthday as birthday,
        suser.sex as sex,
        suser.email as email,
        suser.phone as phone,
        suser.tel as tel,
        suser.status_flag as statusFlag,
        suorg.org_id as orgId,
        suorg.position_id as positionId
        from sys_user suser
        left join sys_user_org suorg on suser.user_id = suorg.user_id
        <where>
            <if test="sysUserRequest.realName != null and sysUserRequest.realName != ''">
                and suser.real_name like concat('%',#{sysUserRequest.realName},'%')
            </if>
            <if test="sysUserRequest.account != null and sysUserRequest.account != ''">
                and suser.account like concat('%',#{sysUserRequest.account},'%')
            </if>
            <if test="sysUserRequest.statusFlag != null and sysUserRequest.statusFlag != ''">
                and suser.status_flag like concat('%',#{sysUserRequest.statusFlag},'%')
            </if>
            <if test="sysUserRequest.orgId != null and sysUserRequest.orgId != ''">
                and suorg.org_id in(select org_id from hr_organization where org_pids like CONCAT('%[',#{sysUserRequest.orgId},']%') or
                org_id=#{sysUserRequest.orgId})
            </if>
            and suser.del_flag = 'N'
            order by suser.create_time desc
        </where>

    </select>
</mapper>
